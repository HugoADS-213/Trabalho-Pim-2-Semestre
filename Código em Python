# Importa o deque pra usar como fila (entra primeiro, sai primeiro)
from collections import deque
# Biblioteca pra salvar os dados em arquivo .csv
import csv
# Rich s√≥ pra deixar a interface mais bonitinha
from rich.console import Console
from rich.panel import Panel

console = Console()

# ==================== BANNER BONIT√ÉO ====================
banner_text = "OLA! BEM-VINDO AO SISTEMA DE NOTAS DA UNIP"
banner_panel = Panel(banner_text, expand=False, padding=(1, 4))
console.print(banner_panel)

# ==================== TODAS AS MAT√âRIAS ====================
    #Abaixo s√£o todas as materia do programa
disciplinas= ['Algoritmos e Estrutura de Dados em Python','Programa√ß√£o estruturada em C','Analise e Projeto de Sistemas','Engenharia de Software Agil']

    #Cria uma fila para as disciplinas
filas_disciplinas = {disciplina: deque() for disciplina in disciplinas}

# ==================== MENU PRINCIPAL ====================
while True:
    # Vai numerar as disciplinas uma abaixo da outra bonitinho
    print("\n===== MENU DE DISCIPLINAS =====")
    for i, disciplina in enumerate(filas_disciplinas, start=1):
        print(f"{i} - {disciplina}")
    print("0 - Sair do programa (salvar tudo)")

    # Aqui come√ßa a parte da seguran√ßa contra erro de digita√ß√£o
    try:
        opcao = input("\nEscolha a disciplina: ").strip()

        # Verifica se a pessoa deixou em branco
        if opcao == "":
            print("‚ö†Ô∏è  Voc√™ precisa digitar um n√∫mero! Tente novamente.")
            continue

        # Verifica se √© realmente um n√∫mero
        if not opcao.isdigit():
            print("‚ö†Ô∏è  Digite apenas n√∫meros, sem letras nem s√≠mbolos!")
            continue

        # Converte pra inteiro agora que temos certeza
        opcao = int(opcao)

        # Verifica se o n√∫mero est√° dentro das op√ß√µes poss√≠veis
        if opcao < 0 or opcao > len(disciplinas):
            print("‚ö†Ô∏è  Op√ß√£o inv√°lida! Escolha um n√∫mero entre 0 e", len(disciplinas))
            continue

    except ValueError:
        print("‚ö†Ô∏è  Digite um n√∫mero v√°lido!")
        continue

    # Se chegou aqui, o valor de 'opcao' √© seguro e o programa segue normal üòé

    # ---------- SAIR E SALVAR OS ARQUIVOS ----------
    if opcao== 0:

        Verificar_alunos= False
        for fila in filas_disciplinas.values(): #Verifica se tem algum aluno independente da materia
            if fila:
                Verificar_alunos = True
                break #Quando tem um aluno continua normalmente o c√≥digo

        if not Verificar_alunos:
            print('N√£o foi cadastrado nenhum aluno, o arquivo n√£o ser√° salvo.\n'
                  'Fechando o c√≥digo...')
            break

        for disciplina, fila in filas_disciplinas.items():
            if fila:  # S√≥ salva se houver alunos cadastrados
                nome_arquivo = f"{disciplina.replace(' ', '_').replace('√£', 'a').replace('√©', 'e').replace('√ß', 'c')}.csv"
                #Abertura do arquivo em csv
                #Newline impede linhas em branco no arquivo
                #Encoding=utf-8 serve para salvar acentos e caracteres especiais
                with open(nome_arquivo, "w", newline="", encoding="utf-8") as arquivo:
                    escritor = csv.writer(arquivo)
                    # Cabe√ßalho do CSV
                    escritor.writerow(["Disciplina", "Nome", "RA", "Turma", "Nota1", "Nota2", "Nota3", "M√©dia"])

                    # Escreve cada aluno
                    for aluno in fila:
                        notas = aluno["Notas"]
                        while len(notas) < 3:  # Garante que existam 3 notas (ou preenche com 0)
                            notas.append(0.0)
                        #Permite que o arquive escreva linhas e j√° separe com v√≠rgulas
                        escritor.writerow([
                            disciplina,
                            aluno["Nome"],
                            aluno["RA"],
                            aluno["Turma"],
                            notas[0],
                            notas[1],
                            notas[2],
                            aluno["M√©dia"]
                        ])
                print(f"Arquivo '{nome_arquivo}' salvo com sucesso!")

        print("\nSaindo do programa... At√© logo!")
        break

    # ---------- MENU DE CADA DISCIPLINA ----------
    if 1 <= opcao <= len(disciplinas):
        disciplina = disciplinas[opcao - 1]
        fila = filas_disciplinas[disciplina]
        print(f"\nDisciplina selecionada: {disciplina}\n")

        while True:
            print(f"\n=== MENU {disciplina.upper()} ===")
            print("1 - Cadastrar aluno")
            print("2 - Cadastrar notas")
            print("3 - Mostrar alunos cadastrados")
            print("4 - Voltar ao menu de disciplinas")

            try:
                escolha = int(input("Escolha uma op√ß√£o: "))
            except ValueError:
                print("Digite um n√∫mero v√°lido!")
                continue

            # ---------- CADASTRAR ALUNO ----------
            if escolha == 1:
                while True:
                    print("\n=== Cadastro de Aluno ===")
                    print("Digite 0 a qualquer momento para voltar.\n")

                    nome = input("Nome do aluno: ")
                    if nome == "0":
                        break

                    ra = input("RA do aluno: ")
                    if ra == "0":
                        break

                    turma = input("Turma do aluno: ")
                    if turma == "0":
                        break

                    # Mostra um resumo pro professor confirmar se digitou certo
                    print("\nConfira os dados informados:")
                    print(f"Nome: {nome}")
                    print(f"RA: {ra}")
                    print(f"Turma: {turma}")

                    confirma = input("Deseja confirmar o cadastro deste aluno? (S/N): ").strip().lower()
                    if confirma in ["s", "ss", "sim"]:
                        aluno = {"Nome": nome, "RA": ra, "Turma": turma, "Notas": [], "M√©dia": 0.0}
                        fila.append(aluno)
                        print("\n‚úÖ Aluno cadastrado com sucesso!\n"
                              "Antes de sair ao menu principal n√£o se esque√ßa de colocar as notas!\n")
                    else:
                        print("\n‚ùå Cadastro cancelado.\n")

                    continuar = input("Deseja cadastrar outro aluno? (S/N): ").strip().lower()
                    if continuar not in ["s", "ss", "sim"]:
                        print("\nVoltando ao menu da disciplina...\n")
                        break

            # ------------------- CADASTRAR NOTAS -------------------
            elif escolha == 2:
                if not fila:
                    print("Nenhum aluno cadastrado ainda!")
                    continue

                while True:
                    print("\nAlunos dispon√≠veis:")
                    for i, aluno in enumerate(fila, start=1):
                        print(f"{i} - {aluno['Nome']} (RA: {aluno['RA']})")
                    print("0 - Voltar")

                    try:
                        escolha_aluno = int(input("\nEscolha o n√∫mero do aluno: "))
                    except ValueError:
                        print("Digite um n√∫mero v√°lido!")
                        continue

                    # Se o professor quiser voltar pro menu de notas
                    if escolha_aluno == 0:
                        print("\nVoltando pro menu de notas...\n")
                        break

                    # Verifica se o n√∫mero do aluno existe
                    if not (1 <= escolha_aluno <= len(fila)):
                        print("Aluno n√£o encontrado!")
                        continue

                    aluno = list(fila)[escolha_aluno - 1]

                    print(f"\n=== Cadastro de notas para {aluno['Nome']} ===")
                    print("Se quiser voltar antes de digitar as notas, digite 'voltar' a qualquer momento!\n")

                    notas = []
                    for i in range(1, 4):
                        while True:
                            entrada = input(f"Digite a {i}¬™ nota (0 a 10): ")

                            # Se o professor se arrependeu e quiser sair antes de terminar as notas
                            if entrada.strip().lower() == "voltar":
                                print("\nBeleza! Voltando pro menu de alunos...\n")
                                notas = None  # Assim a gente n√£o grava notas incompletas
                                break

                            try:
                                nota = float(entrada)
                                if 0 <= nota <= 10:
                                    notas.append(nota)
                                    break
                                else:
                                    print("Nota inv√°lida! Digite um n√∫mero entre 0 e 10.")
                            except ValueError:
                                print("Digite um n√∫mero v√°lido ou 'voltar' pra cancelar.")

                        if notas is None:
                            break  # Sai do loop de notas se o professor quiser voltar

                    # S√≥ grava se ele realmente preencheu as 3 notas
                    if notas and len(notas) == 3:
                        aluno["Notas"] = notas
                        aluno["M√©dia"] = round(sum(notas) / 3, 2)
                        print(f"\n‚úÖ M√©dia de {aluno['Nome']}: {aluno['M√©dia']}\n"
                              f"Para salvar o arquivo saia para o menu principal de materias!\n")
                    else:
                        print("Cadastro de notas cancelado.\n")

                    continuar = input("Deseja cadastrar notas de outro aluno? (S/N): ").strip().lower()
                    if continuar not in ["s", "ss", "sim"]:
                        break

            # ---------- MOSTRAR ALUNOS ----------
            elif escolha == 3:
                if not fila:
                    print("Nenhum aluno cadastrado ainda!")
                    continue

                while True:
                    print("\n=== ALUNOS CADASTRADOS ===")
                    for i, aluno in enumerate(fila, start=1):
                        print(f"{i} - {aluno['Nome']} (RA: {aluno['RA']})")
                    print("0 - Voltar")

                    try:
                        escolha_aluno = int(input("Escolha um aluno para ver detalhes: "))
                    except ValueError:
                        print("Digite um n√∫mero v√°lido!")
                        continue

                    if escolha_aluno == 0:
                        break
                    if not (1 <= escolha_aluno <= len(fila)):
                        print("Aluno n√£o encontrado!")
                        continue

                    aluno = list(fila)[escolha_aluno - 1]
                    print("\n--- Dados do aluno ---")
                    print(f"Nome: {aluno['Nome']}")
                    print(f"RA: {aluno['RA']}")
                    print(f"Turma: {aluno['Turma']}")
                    print(f"Notas: {aluno['Notas']}")
                    print(f"M√©dia: {aluno['M√©dia']}")

            # ---------- VOLTAR ----------
            elif escolha == 4:
                print("\nVoltando ao menu de disciplinas...\n")
                break

            else:
                print("Op√ß√£o inv√°lida! Tente novamente.")
